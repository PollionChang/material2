@import '../core/theming/palette';
@import '../core/theming/theming';
@import '../core/style/form-common';
@import '../core/typography/typography-utils';


// Theme styles that only apply to the box appearance of the form-field.

@mixin mat-form-field-box-theme($theme) {
  $foreground: map-get($theme, foreground);
  $is-dark-theme: map-get($theme, is-dark);

  $box-background: mat-color($foreground, base, if($is-dark-theme, 0.1, 0.06));
  $box-disabled-background: mat-color($foreground, base, if($is-dark-theme, 0.05, 0.03));
  $underline-color: mat-color($foreground, divider, if($is-dark-theme, 0.7, 0.42));

  .mat-form-field-appearance-box {
    .mat-form-field-flex {
      background-color: $box-background;
    }

    &.mat-form-field-disabled .mat-form-field-flex {
      background-color: $box-disabled-background;
    }

    .mat-form-field-underline::before {
      background-color: $underline-color;
    }

    &.mat-form-field-disabled .mat-form-field-underline::before {
      background-color: transparent;
    }
  }
}

// Used to make instances of the _mat-form-field-label-floating mixin negligibly different,
// and prevent Google's CSS Optimizer from collapsing the declarations. This is needed because some
// of the selectors contain pseudo-classes not recognized in all browsers. If a browser encounters
// an unknown pseudo-class it will discard the entire rule set.
$mat-form-field-box-dedupe: 0;

// Applies a floating label above the form field control itself.
@mixin _mat-form-field-box-label-floating($font-scale, $infix-padding, $infix-margin-top) {
  transform: translateY(-$infix-margin-top - $infix-padding + $mat-form-field-box-dedupe)
             scale($font-scale);
  width: 100% / $font-scale + $mat-form-field-box-dedupe;

  $mat-form-field-box-dedupe: $mat-form-field-box-dedupe + 0.00001 !global;
}

@mixin mat-form-field-box-typography($config) {
  // The unit-less line-height from the font config.
  $line-height: mat-line-height($config, input);
  // The amount to scale the font for the floating label and subscript.
  $subscript-font-scale: 0.75;
  // The padding on the infix. Mocks show half of the text size.
  $infix-padding: 0.5em;
  // The margin applied to the form-field-infix to reserve space for the floating label.
  $infix-margin-top: 1em * $line-height * $subscript-font-scale;
  // The amount we offset the label in the box appearance.
  $box-appearance-label-offset: -0.5em * $line-height;

  .mat-form-field-appearance-box {
    .mat-form-field-label {
      margin-top: $box-appearance-label-offset;
    }

    &.mat-form-field-can-float {
      &.mat-form-field-should-float .mat-form-field-label,
      .mat-input-server:focus + .mat-form-field-label-wrapper .mat-form-field-label {
        @include _mat-form-field-label-floating(
                $subscript-font-scale, $infix-padding + $box-appearance-label-offset,
                $infix-margin-top);
      }

      .mat-form-field-autofill-control:-webkit-autofill + .mat-form-field-label-wrapper
      .mat-form-field-label {
        @include _mat-form-field-label-floating(
                $subscript-font-scale, $infix-padding + $box-appearance-label-offset,
                $infix-margin-top);
      }

      // Server-side rendered matInput with a label attribute but label not shown
      // (used as a pure CSS stand-in for mat-form-field-should-float).
      .mat-input-server[label]:not(:label-shown) + .mat-form-field-label-wrapper
      .mat-form-field-label {
        @include _mat-form-field-label-floating(
                $subscript-font-scale, $infix-padding + $box-appearance-label-offset,
                $infix-margin-top);
      }
    }
  }
}
